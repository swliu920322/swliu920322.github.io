name: Deploy
on: [push]

jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest
    permissions:
      id-token: write # ç¨äº Deno Deploy èº«ä»½è®¤è¯
      contents: read # ç¨äºåéä»åº

    steps:
      - name: Clone repository
        uses: actions/checkout@v4

      # æ²¡æä½¿ç¨ npmï¼è¯·å° `npm ci` ä¿®æ¹ä¸º `yarn install` æ `pnpm i`
      - name: Install dependencies
        run: pnpm i

      # æ²¡æä½¿ç¨ npmï¼è¯·å° `npm run build` ä¿®æ¹ä¸º `yarn build` æ `pnpm run build`
      - name: Build Astro
        run: pnpm run build

      - name: Upload to Deno Deploy
        uses: denoland/deployctl@v1
        with:
          project: my-deno-deploy # TODO: æ¿æ¢ä¸º Deno Deploy é¡¹ç®çåç§°
          entrypoint: server/entry.mjs
          root: dist